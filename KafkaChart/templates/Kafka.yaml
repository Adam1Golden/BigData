apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: {{ .Values.clusterName }}
  namespace: {{ .Values.namespace }}
spec:
  kafka:
    replicas: {{ .Values.kafka.replicas }}
    storage:
      type: {{ .Values.kafka.storage.type}}
    {{ if eq .Values.kafka.storage.type "persistent-claim" }}
      size: {{ .Values.kafka.storage.size }}
      deleteClaim: {{ .Values.kafka.storage.deleteClaim }}
    {{ else if eq .Values.kafka.storage.type "jbod"}}
      volumes:
      {{ range $i := until (int .Values.kafka.replicas) }}
        - id: {{ . }}
          type: {{ $.Values.kafka.storage.volume.type }}
          size: {{ $.Values.kafka.storage.volume.size }}
          deleteClaim: {{ $.Values.kafka.storage.volume.deleteClaim }}
      {{ end }}
    {{ end }}
    resources:
      requests:
        memory: {{ .Values.kafka.resources.requests.memory }}
        cpu: {{ .Values.kafka.resources.requests.cpu }}
      limits:
         memory: {{ .Values.kafka.resources.limits.memory }}
         cpu: {{ .Values.kafka.resources.limits.cpu }}
    listeners:
      - name: "plain"
        type: "internal"
        tls: false
        port: 9092
      - name: "tls"
        type: "internal"
        tls: true
        port: 9093
      - name: "external"
        type: "loadbalancer"
        tls: false
        port: {{ .Values.kafka.externalPort }}
  
  zookeeper:
    replicas: 3
    storage:
      type: {{ .Values.zookeeper.storage.type}}
      {{ if eq .Values.zookeeper.storage.type "persistent-claim" }}
      size: {{ .Values.zookeeper.storage.size }}
      deleteClaim: {{ .Values.zookeeper.storage.deleteClaim }}
      {{ end }} 
    resources:
      requests:
        memory: {{ .Values.zookeeper.resources.requests.memory }}
        cpu: {{ .Values.zookeeper.resources.requests.cpu }}
      limits:
         memory: {{ .Values.zookeeper.resources.limits.memory }}
         cpu: {{ .Values.zookeeper.resources.limits.cpu }}

entityOperator:
  topicOperator:
    resources:
      requests:
        memory: {{ .Values.entityOperator | default "3Gi" | quote }}
        cpu: {{ .Values.entityOperator | default 1 | int }}
      limits:
        memory: {{ .Values.entityOperator | default "5Gi" | quote }}
        cpu: {{ .Values.entityOperator | default 2 | int }}
  userOperator:
    resources:
      requests:
        memory: {{ .Values.entityOperator | default "3Gi" | quote }}
        cpu: {{ .Values.entityOperator | default 1 | int }}
      limits:
        memory: {{ .Values.entityOperator | default "5Gi" | quote }}
        cpu: {{ .Values.entityOperator | default 2 | int }}